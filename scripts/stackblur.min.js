function stackBlurImage(a,b,c,d){var e=document.getElementById(a),f=e.naturalWidth,g=e.naturalHeight,h=document.getElementById(b);h.style.width=f+"px",h.style.height=g+"px",h.width=f,h.height=g;var i=h.getContext("2d");i.clearRect(0,0,f,g),i.drawImage(e,0,0),isNaN(c)||c<1||(d?stackBlurCanvasRGBA(b,0,0,f,g,c):stackBlurCanvasRGB(b,0,0,f,g,c))}function stackBlurCanvasRGBA(a,b,c,d,e,f){if(!(isNaN(f)||f<1)){f|=0;var i,g=document.getElementById(a),h=g.getContext("2d");try{try{i=h.getImageData(b,c,d,e)}catch(a){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),i=h.getImageData(b,c,d,e)}catch(a){throw alert("Cannot access local image"),new Error("unable to access local image data: "+a)}}}catch(a){throw alert("Cannot access image"),new Error("unable to access image data: "+a)}var k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,j=i.data,I=f+f+1,K=d-1,L=e-1,M=f+1,N=M*(M+1)/2,O=new BlurStack,P=O;for(m=1;m<I;m++)if(P=P.next=new BlurStack,m==M)var Q=P;P.next=O;var R=null,S=null;q=p=0;var T=mul_table[f],U=shg_table[f];for(l=0;l<e;l++){for(z=A=B=C=r=s=t=u=0,v=M*(D=j[p]),w=M*(E=j[p+1]),x=M*(F=j[p+2]),y=M*(G=j[p+3]),r+=N*D,s+=N*E,t+=N*F,u+=N*G,P=O,m=0;m<M;m++)P.r=D,P.g=E,P.b=F,P.a=G,P=P.next;for(m=1;m<M;m++)n=p+((K<m?K:m)<<2),r+=(P.r=D=j[n])*(H=M-m),s+=(P.g=E=j[n+1])*H,t+=(P.b=F=j[n+2])*H,u+=(P.a=G=j[n+3])*H,z+=D,A+=E,B+=F,C+=G,P=P.next;for(R=O,S=Q,k=0;k<d;k++)j[p+3]=G=u*T>>U,0!=G?(G=255/G,j[p]=(r*T>>U)*G,j[p+1]=(s*T>>U)*G,j[p+2]=(t*T>>U)*G):j[p]=j[p+1]=j[p+2]=0,r-=v,s-=w,t-=x,u-=y,v-=R.r,w-=R.g,x-=R.b,y-=R.a,n=q+((n=k+f+1)<K?n:K)<<2,z+=R.r=j[n],A+=R.g=j[n+1],B+=R.b=j[n+2],C+=R.a=j[n+3],r+=z,s+=A,t+=B,u+=C,R=R.next,v+=D=S.r,w+=E=S.g,x+=F=S.b,y+=G=S.a,z-=D,A-=E,B-=F,C-=G,S=S.next,p+=4;q+=d}for(k=0;k<d;k++){for(A=B=C=z=s=t=u=r=0,p=k<<2,v=M*(D=j[p]),w=M*(E=j[p+1]),x=M*(F=j[p+2]),y=M*(G=j[p+3]),r+=N*D,s+=N*E,t+=N*F,u+=N*G,P=O,m=0;m<M;m++)P.r=D,P.g=E,P.b=F,P.a=G,P=P.next;for(o=d,m=1;m<=f;m++)p=o+k<<2,r+=(P.r=D=j[p])*(H=M-m),s+=(P.g=E=j[p+1])*H,t+=(P.b=F=j[p+2])*H,u+=(P.a=G=j[p+3])*H,z+=D,A+=E,B+=F,C+=G,P=P.next,m<L&&(o+=d);for(p=k,R=O,S=Q,l=0;l<e;l++)n=p<<2,j[n+3]=G=u*T>>U,G>0?(G=255/G,j[n]=(r*T>>U)*G,j[n+1]=(s*T>>U)*G,j[n+2]=(t*T>>U)*G):j[n]=j[n+1]=j[n+2]=0,r-=v,s-=w,t-=x,u-=y,v-=R.r,w-=R.g,x-=R.b,y-=R.a,n=k+((n=l+M)<L?n:L)*d<<2,r+=z+=R.r=j[n],s+=A+=R.g=j[n+1],t+=B+=R.b=j[n+2],u+=C+=R.a=j[n+3],R=R.next,v+=D=S.r,w+=E=S.g,x+=F=S.b,y+=G=S.a,z-=D,A-=E,B-=F,C-=G,S=S.next,p+=d}h.putImageData(i,b,c)}}function stackBlurCanvasRGB(a,b,c,d,e,f){if(!(isNaN(f)||f<1)){f|=0;var i,g=document.getElementById(a),h=g.getContext("2d");try{try{i=h.getImageData(b,c,d,e)}catch(a){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),i=h.getImageData(b,c,d,e)}catch(a){throw alert("Cannot access local image"),new Error("unable to access local image data: "+a)}}}catch(a){throw alert("Cannot access image"),new Error("unable to access image data: "+a)}var k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,j=i.data,E=f+f+1,G=d-1,H=e-1,I=f+1,J=I*(I+1)/2,K=new BlurStack,L=K;for(m=1;m<E;m++)if(L=L.next=new BlurStack,m==I)var M=L;L.next=K;var N=null,O=null;q=p=0;var P=mul_table[f],Q=shg_table[f];for(l=0;l<e;l++){for(x=y=z=r=s=t=0,u=I*(A=j[p]),v=I*(B=j[p+1]),w=I*(C=j[p+2]),r+=J*A,s+=J*B,t+=J*C,L=K,m=0;m<I;m++)L.r=A,L.g=B,L.b=C,L=L.next;for(m=1;m<I;m++)n=p+((G<m?G:m)<<2),r+=(L.r=A=j[n])*(D=I-m),s+=(L.g=B=j[n+1])*D,t+=(L.b=C=j[n+2])*D,x+=A,y+=B,z+=C,L=L.next;for(N=K,O=M,k=0;k<d;k++)j[p]=r*P>>Q,j[p+1]=s*P>>Q,j[p+2]=t*P>>Q,r-=u,s-=v,t-=w,u-=N.r,v-=N.g,w-=N.b,n=q+((n=k+f+1)<G?n:G)<<2,x+=N.r=j[n],y+=N.g=j[n+1],z+=N.b=j[n+2],r+=x,s+=y,t+=z,N=N.next,u+=A=O.r,v+=B=O.g,w+=C=O.b,x-=A,y-=B,z-=C,O=O.next,p+=4;q+=d}for(k=0;k<d;k++){for(y=z=x=s=t=r=0,p=k<<2,u=I*(A=j[p]),v=I*(B=j[p+1]),w=I*(C=j[p+2]),r+=J*A,s+=J*B,t+=J*C,L=K,m=0;m<I;m++)L.r=A,L.g=B,L.b=C,L=L.next;for(o=d,m=1;m<=f;m++)p=o+k<<2,r+=(L.r=A=j[p])*(D=I-m),s+=(L.g=B=j[p+1])*D,t+=(L.b=C=j[p+2])*D,x+=A,y+=B,z+=C,L=L.next,m<H&&(o+=d);for(p=k,N=K,O=M,l=0;l<e;l++)n=p<<2,j[n]=r*P>>Q,j[n+1]=s*P>>Q,j[n+2]=t*P>>Q,r-=u,s-=v,t-=w,u-=N.r,v-=N.g,w-=N.b,n=k+((n=l+I)<H?n:H)*d<<2,r+=x+=N.r=j[n],s+=y+=N.g=j[n+1],t+=z+=N.b=j[n+2],N=N.next,u+=A=O.r,v+=B=O.g,w+=C=O.b,x-=A,y-=B,z-=C,O=O.next,p+=d}h.putImageData(i,b,c)}}function BlurStack(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var mul_table=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],shg_table=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];